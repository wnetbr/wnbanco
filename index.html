<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WN BANCO</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #00ffa3;
            --accent: #d4af37;
            --bg: #0a111f;
            --card-bg: #152033;
            --text-main: #ffffff;
            --text-sec: #94a3b8;
            --danger: #ff4d4d;
            --border: rgba(255, 255, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background-color: var(--bg); background-image: radial-gradient(circle at top right, #1e293b, #0a111f); color: var(--text-main); display: flex; justify-content: center; min-height: 100vh; }
        .app-container { width: 100%; max-width: 480px; padding: 25px; }

        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .logo { font-weight: 800; font-size: 26px; letter-spacing: -1px; }
        .logo span { color: var(--accent); }

        .main-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            padding: 35px; border-radius: 28px; border: 1px solid var(--border);
            margin-bottom: 35px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .balance-label { color: var(--text-sec); font-size: 12px; text-transform: uppercase; letter-spacing: 2px; }
        .balance-value { font-size: 34px; font-weight: 800; margin-top: 8px; display: flex; gap: 8px; align-items: baseline; }

        .actions-nav { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 40px; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 10px; cursor: pointer; }
        .nav-icon {
            width: 60px; height: 60px; background: var(--card-bg); border-radius: 20px;
            display: flex; align-items: center; justify-content: center; color: var(--accent);
            border: 1px solid var(--border); transition: 0.3s;
        }
        .nav-item:hover .nav-icon { background: var(--accent); color: #000; }
        .nav-item span { font-size: 11px; color: var(--text-sec); font-weight: 700; text-transform: uppercase; }

        .transaction-item { background: var(--card-bg); padding: 20px; border-radius: 22px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; cursor: pointer; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: #152033; width: 90%; max-width: 400px; border-radius: 30px; padding: 30px; border: 1px solid var(--border); }
        
        input, select { width: 100%; padding: 18px; margin: 8px 0; background: #0a111f; border: 1px solid #2d3748; color: white; border-radius: 15px; }
        .btn-action { width: 100%; padding: 20px; background: var(--accent); color: #000; border: none; border-radius: 18px; font-weight: 800; cursor: pointer; margin-top: 10px; }
        .btn-share { width: 100%; padding: 15px; background: #f0f0f0; color: #000; border: none; border-radius: 18px; font-weight: 700; cursor: pointer; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }

        #camera-preview { width: 100%; height: 200px; background: #000; border-radius: 15px; margin-bottom: 15px; position: relative; overflow: hidden; border: 1px solid var(--accent); }
        .scan-anim { position: absolute; width: 100%; height: 2px; background: var(--primary); top: 0; animation: scan 2s infinite; box-shadow: 0 0 10px var(--primary); }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }

        .receipt-overlay { background: linear-gradient(180deg, #0a111f 0%, #1e293b 100%); padding: 20px; border-radius: 30px; width: 100%; }
        .receipt-container { background: #ffffff; color: #1a1a1a; padding: 30px; border-radius: 20px; font-size: 13px; position: relative; }
        .receipt-header { border-bottom: 2px solid #f0f0f0; padding-bottom: 15px; margin-bottom: 15px; text-align: center; }
        .receipt-label { color: #888; font-weight: 600; font-size: 11px; text-transform: uppercase; margin-top: 12px; }
        .receipt-value { color: #000; font-weight: 700; font-size: 14px; }
        .receipt-auth { background: #f8fafc; padding: 12px; font-family: monospace; font-size: 10px; margin-top: 20px; border-radius: 8px; color: #64748b; border: 1px solid #edf2f7; line-height: 1.4; }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <div class="logo">NG CASH<span>.</span></div>
        <div style="background: var(--card-bg); padding: 10px; border-radius: 12px;"><i data-lucide="user" size="20" style="color: var(--accent)"></i></div>
    </header>

    <div class="main-card">
        <div class="balance-label">Saldo em conta</div>
        <div class="balance-value"><span style="color: var(--accent)">R$</span><span id="main-balance">10.000,00</span></div>
    </div>

    <nav class="actions-nav">
        <div class="nav-item" onclick="openModal('modal-select-key-qr')">
            <div class="nav-icon"><i data-lucide="qr-code"></i></div>
            <span>Ler QR</span>
        </div>
        <div class="nav-item" onclick="openModal('modal-pix')">
            <div class="nav-icon"><i data-lucide="send"></i></div>
            <span>Pix</span>
        </div>
        <div class="nav-item" onclick="openModal('modal-keys')">
            <div class="nav-icon"><i data-lucide="key"></i></div>
            <span>Chaves</span>
        </div>
        <div class="nav-item" onclick="openModal('modal-deposit')">
            <div class="nav-icon"><i data-lucide="wallet"></i></div>
            <span>Depositar</span>
        </div>
    </nav>

    <section>
        <h3 style="margin-bottom: 20px; font-size: 18px; color: var(--text-sec);">Extrato de Atividade</h3>
        <div id="history-list"></div>
    </section>
</div>

<div id="modal-select-key-qr" class="modal">
    <div class="modal-content">
        <h3>Selecione o Destinatário</h3>
        <select id="qr-destiny-key-select"></select>
        <button class="btn-action" onclick="startQRScannerFlow()">Abrir Leitor</button>
        <button class="btn-action" style="background:none; color:#fff" onclick="closeModal()">Cancelar</button>
    </div>
</div>

<div id="modal-qr-scanner" class="modal">
    <div class="modal-content">
        <h3>QR Code</h3>
        <div id="camera-preview"><div class="scan-anim"></div><video id="v" playsinline autoplay style="width:100%;height:100%;object-fit:cover;"></video></div>
        <p style="text-align:center; font-size:12px; color:var(--text-sec);">Identificando código...</p>
    </div>
</div>

<div id="modal-amount" class="modal">
    <div class="modal-content">
        <h3>Valor do Pagamento</h3>
        <p style="color:var(--accent); font-size:12px; margin-bottom:10px;">Para: <span id="target-display"></span></p>
        <input type="number" id="input-amount" placeholder="R$ 0,00">
        <button class="btn-action" onclick="prepareTransfer()">Continuar</button>
        <button class="btn-action" style="background:none; color:#fff" onclick="closeModal()">Sair</button>
    </div>
</div>

<div id="modal-password" class="modal">
    <div class="modal-content">
        <h3>Digite sua Senha</h3>
        <p style="color:var(--text-sec); font-size:12px; margin-bottom:15px;">Transação de R$ <span id="confirm-val"></span></p>
        <input type="password" id="pass-input" placeholder="******" maxlength="6" style="text-align:center; letter-spacing:8px;">
        <button class="btn-action" onclick="confirmTransfer()">Confirmar</button>
    </div>
</div>

<div id="modal-pix" class="modal">
    <div class="modal-content">
        <h3>Transferência Pix</h3>
        <select id="pix-destiny-key"></select>
        <input type="number" id="pix-amount" placeholder="Valor R$">
        <button class="btn-action" onclick="prepareTransfer('pix')">Continuar</button>
        <button class="btn-action" style="background:none; color:#fff" onclick="closeModal()">Sair</button>
    </div>
</div>

<div id="modal-keys" class="modal">
    <div class="modal-content">
        <h3>Salvar Novo Contato</h3>
        <input type="text" id="new-key-name" placeholder="Nome">
        <input type="text" id="new-key-value" placeholder="Chave Pix">
        <input type="text" id="new-key-bank" placeholder="Banco">
        <button class="btn-action" onclick="saveKey()">Salvar</button>
        <div id="keys-list" style="margin-top: 15px; max-height: 80px; overflow-y: auto;"></div>
        <button class="btn-action" style="background:none; color:#fff" onclick="closeModal()">Voltar</button>
    </div>
</div>

<div id="modal-deposit" class="modal">
    <div class="modal-content">
        <h3>Depositar</h3>
        <input type="number" id="dep-amount" placeholder="Valor">
        <button class="btn-action" onclick="addBalance()">Confirmar</button>
        <button class="btn-action" style="background:none; color:#fff" onclick="closeModal()">Sair</button>
    </div>
</div>

<div id="modal-receipt" class="modal">
    <div class="modal-content" style="background: transparent; border: none; padding: 0;">
        <div class="receipt-overlay">
            <div class="receipt-container" id="receipt-area">
                <div class="receipt-header">
                    <div style="font-weight: 800; font-size: 24px; color: #1a1a1a;">NG CASH<span>.</span></div>
                    <div style="font-weight: 700; font-size: 11px; color: #888;">COMPROVANTE PIX</div>
                </div>
                <div class="receipt-label">Valor</div>
                <div class="receipt-value" id="rec-amount" style="font-size: 22px;"></div>
                <div class="receipt-label">Origem</div>
                <div class="receipt-value">Douglas Gomes Davila</div>
                <div class="receipt-label">Instituição</div>
                <div class="receipt-value">NG CASH S.A.</div>
                <div style="border-top: 1px solid #f0f0f0; margin: 15px 0;"></div>
                <div class="receipt-label">Destino</div>
                <div class="receipt-value" id="rec-to-name"></div>
                <div class="receipt-label">Chave Pix</div>
                <div class="receipt-value" id="rec-to-key"></div>
                <div class="receipt-label">Instituição de Destino</div>
                <div class="receipt-value" id="rec-to-bank"></div>
                <div class="receipt-label">Data e Hora</div>
                <div class="receipt-value" id="rec-date"></div>
                <div class="receipt-auth"><strong>ID:</strong> <span id="rec-id"></span><br><strong>AUTENTICAÇÃO:</strong> <span id="rec-auth"></span></div>
            </div>
            <button class="btn-share" onclick="shareReceipt()"><i data-lucide="share-2" size="18"></i> Compartilhar</button>
            <button class="btn-action" style="margin-top:10px;" onclick="closeModal()">Fechar</button>
        </div>
    </div>
</div>

<script>
    let state = JSON.parse(localStorage.getItem('wn_v11_data')) || { balance: 10000.00, keys: [], history: [] };
    let tempTx = {};
    let stream = null;

    function save() { localStorage.setItem('wn_v11_data', JSON.stringify(state)); render(); }

    function render() {
        document.getElementById('main-balance').innerText = state.balance.toLocaleString('pt-BR', {minimumFractionDigits: 2});
        const list = document.getElementById('history-list');
        list.innerHTML = state.history.length === 0 ? '<p style="text-align:center; color:var(--text-sec); padding:30px;">Sem movimentações</p>' : '';
        state.history.slice().reverse().forEach((item, index) => {
            const isNeg = item.amount < 0;
            list.innerHTML += `<div class="transaction-item" onclick="showReceipt(${state.history.length-1-index})">
                <div style="display:flex; align-items:center; gap:15px;"><i data-lucide="${isNeg?'arrow-up-right':'arrow-down-left'}" style="color:${isNeg?'var(--danger)':'var(--primary)'}"></i>
                <div><div style="font-weight:700; font-size:14px;">${item.title}</div><div style="color:var(--text-sec); font-size:11px;">${item.date}</div></div></div>
                <div style="font-weight:800; color:${isNeg?'var(--danger)':'var(--primary)'}">R$ ${Math.abs(item.amount).toFixed(2)}</div></div>`;
        });
        
        const pixSel = document.getElementById('pix-destiny-key');
        const qrSel = document.getElementById('qr-destiny-key-select');
        pixSel.innerHTML = '<option value="">Selecione um contato</option>';
        qrSel.innerHTML = '<option value="">Escolha um contato</option>';
        state.keys.forEach(k => {
            const opt = `<option value="${k.key}">${k.name}</option>`;
            pixSel.innerHTML += opt;
            qrSel.innerHTML += opt;
        });

        const kList = document.getElementById('keys-list');
        kList.innerHTML = '';
        state.keys.forEach(k => kList.innerHTML += `<div style="font-size:11px; padding:8px; border-bottom:1px solid var(--border)">${k.name} (${k.bank})</div>`);
        lucide.createIcons();
    }

    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); if(stream) stream.getTracks().forEach(t=>t.stop()); }

    async function startQRScannerFlow() {
        const key = document.getElementById('qr-destiny-key-select').value;
        if(!key) return alert("Selecione um contato!");
        tempTx.target = state.keys.find(k => k.key === key);
        closeModal();
        openModal('modal-qr-scanner');
        
        try {
            stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment" },
                audio: false 
            });
            const videoElement = document.getElementById('v');
            videoElement.srcObject = stream;
            videoElement.setAttribute("playsinline", true); 
            videoElement.play();

            setTimeout(() => { 
                closeModal(); 
                document.getElementById('target-display').innerText = tempTx.target.name; 
                openModal('modal-amount'); 
            }, 3000);
        } catch(e) { 
            console.error(e);
            alert("Erro ao acessar câmera: " + e.message); 
            closeModal(); 
        }
    }

    function prepareTransfer(source) {
        let amt;
        if(source === 'pix') {
            const key = document.getElementById('pix-destiny-key').value;
            tempTx.target = state.keys.find(k => k.key === key);
            amt = parseFloat(document.getElementById('pix-amount').value);
        } else {
            amt = parseFloat(document.getElementById('input-amount').value);
        }
        if(!amt || amt <= 0 || amt > state.balance) return alert("Erro no valor ou saldo.");
        tempTx.amt = amt;
        document.getElementById('confirm-val').innerText = amt.toFixed(2);
        closeModal(); openModal('modal-password');
    }

    function confirmTransfer() {
        if(document.getElementById('pass-input').value === '174510') {
            state.balance -= tempTx.amt;
            state.history.push({
                title: `Pix para ${tempTx.target.name}`, amount: -tempTx.amt, date: new Date().toLocaleString('pt-BR'),
                toName: tempTx.target.name, toKey: tempTx.target.key, toBank: tempTx.target.bank,
                id: 'WN' + Math.random().toString().substr(2,8).toUpperCase(),
                auth: Math.random().toString(36).substr(2,15).toUpperCase()
            });
            document.getElementById('pass-input').value = '';
            save(); closeModal(); showReceipt(state.history.length-1);
        } else { alert("Senha Incorreta!"); }
    }

    function addBalance() {
        const val = parseFloat(document.getElementById('dep-amount').value);
        if(val > 0) { state.balance += val; state.history.push({ title: 'Depósito Recebido', amount: val, date: new Date().toLocaleString('pt-BR'), isDeposit: true }); save(); closeModal(); }
    }

    function saveKey() {
        const n = document.getElementById('new-key-name').value;
        const k = document.getElementById('new-key-value').value;
        const b = document.getElementById('new-key-bank').value;
        if(n && k && b) { state.keys.push({name:n, key:k, bank:b}); save(); }
    }

    function showReceipt(i) {
        const item = state.history[i];
        if(item.isDeposit) return;
        document.getElementById('rec-amount').innerText = `R$ ${Math.abs(item.amount).toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
        document.getElementById('rec-to-name').innerText = item.toName;
        document.getElementById('rec-to-key').innerText = item.toKey;
        document.getElementById('rec-to-bank').innerText = item.toBank;
        document.getElementById('rec-date').innerText = item.date;
        document.getElementById('rec-id').innerText = item.id;
        document.getElementById('rec-auth').innerText = item.auth;
        openModal('modal-receipt');
    }

    function shareReceipt() {
        const text = `Comprovante NG CASH\nValor: ${document.getElementById('rec-amount').innerText}\nDestino: ${document.getElementById('rec-to-name').innerText}\nData: ${document.getElementById('rec-date').innerText}`;
        if (navigator.share) {
            navigator.share({ title: 'Comprovante Pix', text: text }).catch(() => {});
        } else {
            alert("Copiado para a área de transferência!");
            navigator.clipboard.writeText(text);
        }
    }

    render();
</script>
</body>
</html>
